{% extends 'base.html' %}
{% block content %}

<main class="messages-main-wrapper">
    <h2>Send New Message</h2>
    <div class="send-new-message">
        <form class="new-message-form" id="new-message-form">
            <div class="write-message-wrapper">
                <select name="recipient_id" id="recipient_id" required>
                    <option value="" disabled selected>Select a user</option>
                    {% for user in users %}
                    <option value="{{ user.id }}">{{ user.username }}</option>
                    {% endfor %}
                </select>

                <textarea name="content" placeholder="Write your message..." required></textarea>
                <button class="inbox-button" type="submit">Send</button>
            </div>
        </form>
    </div>

    <h2>Message Threads</h2>

    <div class="message-threads">
        <div class="conversation-list">
            {% for user in conversations %}
                <div class="thread-item">
                    <a href="{{ url_for('messages', username=user.username) }}">
                    ğŸ’¬ {{ user.username }}
                    </a>
                </div>
            {% else %}
                No messages yet.
            {% endfor %}
        </div>
        <div class="messages-container">
            {% for msg in messages %}
                <div class="message-wrapper">
                    <div class="message {{ 'sent' if msg.sender_id == session['user_id'] else 'received' }}">
                        <div class="content">{{ msg.content }}</div>
                        <div class="meta">{{ msg.sender.username }} â€¢ <span class="timestamp" data-timestamp="{{ msg.timestamp.isoformat() + 'Z' }}"></span>
                    </div>
                </div>
            {% endfor %}
        </div>
        <form id="message-form" class="message-form">
            <div class="message-input-container">
                <input type="hidden" name="recipient_id" value="{{ recipient.id }}">
                <input class="compose-message" name="content" placeholder="Write a message..." required />
            </div>
        </form>
    </div>
    <script src="{{ url_for('static', filename='js/messages.js') }}"></script>
</main>

{% endblock %}
