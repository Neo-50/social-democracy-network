{% extends "base.html" %}
{% block content %}
<div class="max-w-2xl mx-auto">
	<h1>Save-a-Tweet (archive-x)</h1>

	<form method="post" id="archive-form">
		<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
		<label for="url">Tweet URL</label>
		<input id="url" name="url" type="url" required placeholder="https://x.com/username/status/1770â€¦">
		<button type="submit">Download</button>
	</form>
	<form id="order-form" method="get" action="{{ url_for('archive_x.archive_x_page') }}" style="margin:1rem 0;">
		<label for="order">Sort by:</label>
		<select id="order" name="order">
			<option value="desc" {% if current_order == 'desc' %}selected{% endif %}>Newest first</option>
			<option value="asc"  {% if current_order == 'asc'  %}selected{% endif %}>Oldest first</option>
		</select>
		<noscript><button type="submit">Apply</button></noscript>
	</form>

	<div id="feed">
		{% if initial_items %}
			{% for it in initial_items %}
				<div class="tweet-card">
					Tweet ID: {{ it.tweet_id }}
					<div>Source URL: <a href="{{ it.meta.url }}">{{ it.meta.url }}</a></div>
					{% if it.meta %}
						<div style="margin-bottom:.35rem;">
							<br>
							{% if it.meta.author_name or it.meta.author_handle %}
								<span>@{{ it.meta.author_handle }}</span>
								{% if it.meta.author_name %} â€” <strong>{{ it.meta.author_name }}</strong>{% endif %}
							{% endif %}
						</div>
						{% if it.meta.text %}
							<p style="margin:.25rem 0 .5rem 0;">{{ it.meta.text }}</p>
						{% endif %}
					{% endif %}

					<div class="gallery">
						{% for m in it.media %}
							{% if m.kind == 'video' %}
							<video class="twitter-video" controls preload="metadata" playsinline>
								<source src="{{ url_for('media', filename=m.rel_path) }}" type="video/mp4">
							</video>
							{% elif m.kind == 'image' %}
							<p><img class="twitter-image" src="{{ url_for('media', filename=m.rel_path) }}" alt=""></p>
							{% endif %}
						{% endfor %}
					</div>

					<div style="line-height: 5px">
						<span class="timestamp" data-timestamp="{{ it.meta.created_at_utc or it.meta.timestamp }}">
							{{ it.meta.created_at_utc or it.meta.timestamp }}
						</span>
						<hr>
						</p>
						<p>ğŸ‘€ {{ it.meta.views }} | â¤ï¸ {{ it.meta.likes }} | ğŸ’¬ {{ it.meta.comments }}
							 | ğŸ” {{ it.meta.retweets }} |  â€ {{ it.meta.quotes }} | ğŸ”– {{ it.meta.bookmarks }}</p>
					</div>
				</div>
			{% endfor %}
		{% endif %}
	</div>
</div>

<script src="{{ url_for('static', filename='js/archive_x.js') }}"></script>
</div>
{% endblock %}
