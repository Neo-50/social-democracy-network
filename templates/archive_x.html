{% extends "base.html" %}
{% block content %}
<div class="max-w-2xl mx-auto">
	<h1><a href="https://social-democracy.net/archive-x">Save-a-Tweet (archive-x)</a></h1>
	<div class="totals">Total Tweets Archived: <strong>{{ total_tweets }}</strong></br><hr>
	Total for {{ month_name }}, {{ current_year }}: <strong>{{ monthly_total }}</strong></div>
	<div class="control-panel">
		<form method="post" id="archive-form">
			<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
			<label for="url">Tweet URL:</label><br>
			<input id="url" name="url" type="url" required placeholder="https://x.com/username/status/1770â€¦">
			<button type="submit" class="download-tweet">Download</button>
		</form>
		<div class="filters">
			<label>
				Order:
				<select id="orderSel">
					<option value="desc" {{ 'selected' if current_order == 'desc' else '' }}>Newest first</option>
					<option value="asc"  {{ 'selected' if current_order == 'asc' else '' }}>Oldest first</option>
				</select>
			</label>
			<label>
				<br>Month:
				<select id="monthSel">
					{% for val, name in months %}
						<option value="{{ val }}" {{ 'selected' if val == current_month else '' }}>{{ name }}</option>
					{% endfor %}
				</select>
			</label>
			<label>
				<br>Year:
				<select id="yearSel">
					{% for y in years %}
						<option value="{{ y }}" {{ 'selected' if y == current_year else '' }}>{{ y }}</option>
					{% endfor %}
				</select>
			</label>
		</div>
	</div>

	<div id="feed">
		{% if initial_items %}
			{% for it in initial_items %}
				<div class="tweet-card">
					Tweet ID: {{ it.tweet_id }}
					<div>Source URL: <a href="{{ it.meta.url }}" target="_blank">{{ it.meta.url }}</a></div>
					{% if it.meta %}
						<div style="margin-bottom:.35rem;">
							<br>
							{% if it.meta.author_name or it.meta.author_handle %}
								<span>@{{ it.meta.author_handle }}</span>
								{% if it.meta.author_name %} â€” <strong>{{ it.meta.author_name }}</strong>{% endif %}
							{% endif %}
						</div>
						{% if it.meta.text %}
							<div class="tweet-text">{{ it.meta.text | safe }}</div>
						{% endif %}
					{% endif %}

					<div class="gallery">
						{% for m in it.media %}
							{% if m.kind == 'video' %}
							<video class="twitter-video" controls preload="metadata" playsinline>
								<source src="{{ url_for('media', filename=m.rel_path) }}" type="video/mp4">
							</video>
							{% elif m.kind == 'image' %}
							<p><img class="twitter-image" src="{{ url_for('media', filename=m.rel_path) }}" alt=""></p>
							{% endif %}
						{% endfor %}
					</div>

					<div style="line-height: 5px">
						<span class="timestamp" data-timestamp="{{ it.meta.created_at_utc or it.meta.timestamp }}">
							{{ it.meta.created_at_utc or it.meta.timestamp }}
						</span>
						<hr>
						</p>
						<p>ğŸ‘€ {{ it.meta.views }} | â¤ï¸ {{ it.meta.likes }} | ğŸ’¬ {{ it.meta.comments }}
							 | ğŸ” {{ it.meta.retweets }} |  â€ {{ it.meta.quotes }} | ğŸ”– {{ it.meta.bookmarks }}</p>
					</div>
					<button type="button" class="sharelink" onclick="copyTweetLink('{{ it.tweet_id }}')">ğŸ”— Copy Share Link</button>
				</div>
			{% endfor %}
		{% endif %}
	</div>
	<div class="disclaimer"><strong><u>Disclaimer:</u></strong><br>
		<strong>Fair Use</strong> This archive operates under the principles of fair use as defined in 17 U.S.C. Â§107.
		Reproduction is limited to what is necessary for commentary, criticism, news reporting, education, and research.
		All content is presented for non-commercial, informational purposes with attribution to the original source.
	</div>
</div>

<script src="{{ url_for('static', filename='js/archive_x.js') }}"></script>
</div>
{% endblock %}
